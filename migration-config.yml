migrations:
  # 1. ASP.NET Core Migration
  # Real-world scenario: IHostingEnvironment was obsolete in 3.0 and removed in later versions.
  # Replaced by IWebHostEnvironment.
  - id: 'aspnet-core-migration'
    package_name: 'Microsoft.AspNetCore.App'
    description: 'Migrate ASP.NET Core legacy hosting types'
    version_conditions:
      - type: 'greater_than_or_equal'
        version: '3.0.0'
    rules:
      - name: 'Replace IHostingEnvironment field type'
        target_nodes:
          - type: 'FieldDeclaration'
            identifier: 'IHostingEnvironment'
        action:
          type: 'replace_field_type'
          replacement_type: 'IWebHostEnvironment'
      
      - name: 'Replace IHostingEnvironment parameter type'
        target_nodes:
          - type: 'ParameterDeclaration'
            identifier: 'IHostingEnvironment'
        action:
          type: 'replace_parameter_type'
          replacement_type: 'IWebHostEnvironment'

  # 2. Entity Framework Core Migration
  # Real-world scenario: Cleanup of obsolete methods and pattern updates.
  - id: 'ef-core-migration'
    package_name: 'Microsoft.EntityFrameworkCore'
    description: 'Update Entity Framework Core patterns and remove obsolete calls'
    version_conditions:
      - type: 'greater_than'
        version: '6.0.0'
    rules:
      - name: 'Remove obsolete AddDelegatingHandler'
        target_nodes:
          - type: 'InvocationExpression'
            method_name: 'AddDelegatingHandler'
        action:
          type: 'remove_invocation'
          strategy: 'smart_chain_aware'

      - name: 'Update ConfigureDbContext to AddDbContext'
        target_nodes:
          - type: 'InvocationExpression'
            method_name: 'ConfigureDbContext'
        action:
          type: 'replace_invocation'
          replacement_method: 'AddDbContext'

      - name: 'Remove obsolete EnsureCreated calls'
        target_nodes:
          - type: 'InvocationExpression'
            method_name: 'EnsureCreated'
            containing_namespace: 'Microsoft.EntityFrameworkCore'
        action:
          type: 'remove_invocation'
          strategy: 'smart_chain_aware'

  # 3. Newtonsoft.Json Migration
  # Real-world scenario: Renaming async methods to match new conventions or custom extensions.
  - id: 'newtonsoft-migration'
    package_name: 'Newtonsoft.Json'
    description: 'Update Newtonsoft.Json method names'
    version_conditions:
      - type: 'greater_than_or_equal'
        version: '13.0.0'
    rules:
      - name: 'Rename SerializeObjectAsync to SerializeAsync'
        target_nodes:
          - type: 'InvocationExpression'
            method_name: 'SerializeObjectAsync'
            containing_namespace: 'Newtonsoft.Json'
        action:
          type: 'replace_invocation'
          replacement_method: 'SerializeAsync'
      
      - name: 'Rename DeserializeObjectAsync to DeserializeAsync'
        target_nodes:
          - type: 'InvocationExpression'
            method_name: 'DeserializeObjectAsync'
            containing_namespace: 'Newtonsoft.Json'
        action:
          type: 'replace_invocation'
          replacement_method: 'DeserializeAsync'
